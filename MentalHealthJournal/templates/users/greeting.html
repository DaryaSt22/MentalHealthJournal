{% load static %}
<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Mental Health Journal</title>

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
          crossorigin="anonymous"/>
    <link rel="apple-touch-icon" sizes="180x180" href="{% static 'css/apple-touch-icon.png' %}"/>
    <link rel="icon" type="image/png" sizes="32x32" href="{% static 'css/favicon-32x32.png' %}"/>
    <link rel="icon" type="image/png" sizes="16x16" href="{% static 'css/favicon-16x16.png' %}"/>
    <link rel="manifest" href="/site.webmanifest"/>
    <link rel="stylesheet" href="{% static 'css/index.css' %}">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <style>
        .navbar .navbar-brand, .navbar .nav-link { margin-left: 0 !important; }
        .navbar .nav-link:hover, .navbar .nav-link:focus { opacity: .9; }
    </style>
</head>
<body>
{% include 'partials/header.html' %}

<div class="main-content container py-4">
    <div class="text-center my-4">
        <div class="row">
            <div class="col-lg-6 mx-auto">
                <img class="rounded-circle img-fluid mb-3"
                     src="{% static 'css/mental.jpg' %}"
                     alt="Give himself a hand"
                     style="max-width: 400px; height: auto;"/>
                <h1 class="fw-light">Track your moods, discover patterns, and improve your well-being</h1>
            </div>
        </div>
    </div>

    <div class="my-5">
        <div style="max-width: 500px; margin: 0 auto;">
            <canvas id="pie-chart"></canvas>
        </div>
    </div>

</div>

{{ labels|json_script:"chart-labels" }}
{{ data|json_script:"chart-data" }}

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
        crossorigin="anonymous"></script>
<script>
    document.addEventListener('DOMContentLoaded', function () {
      const labelsEl = document.getElementById('chart-labels');
      const dataEl = document.getElementById('chart-data');
      const labels = labelsEl ? JSON.parse(labelsEl.textContent) : [];
      const data = dataEl ? JSON.parse(dataEl.textContent) : [];

      const sum = data.reduce((a, b) => a + (+b || 0), 0);
      if (sum === 0) {
        const c = document.getElementById('pie-chart');
        if (c) {
          const stub = document.createElement('div');
          stub.className = 'text-center text-muted py-5';
          stub.textContent = 'Пока нет данных для диаграммы';
          c.replaceWith(stub);
        }
        return;
      }

      const canvas = document.getElementById('pie-chart');
      if (!canvas || !window.Chart) return;
      const ctx = canvas.getContext('2d');
      new Chart(ctx, {
        type: 'pie',
        data: {
          labels: labels,
          datasets: [{
            data: data,
            backgroundColor: [
              '#e6194b','#f58231','#3cb44b','#4363d8','#ffe119',
              '#911eb4','#46f0f0','#f032e6','#bcf60c','#fabed4','#008080'
            ],
            borderWidth: 0
          }]
        },
        options: {
                    responsive: true,
                    plugins: {
                        legend: { position: 'bottom' },
                        title: {
                        display: true,
                        text: 'Stress level per users',
                        padding: { top: 8, bottom: 12 },
                        font: { size: 18, weight: '600' }
                        }
                   }
        }
      });
    });
</script>
</body>
</html>
